{% extends 'base.html' %} {% block content %}

<div class="container p-5 w-80">
  <h1 class="text-center">TP Final</h1>
  <form method="GET" action="/tp-final" id="simulation-form">
    <div
      class="rounded border border-dark-subtle bg-secondary-subtle p-4 mt-5 container row"
    >
      <div class="row align-items-end">
        <div class="col-md-4">
          <div class="form-group mb-3">
            <label for="start_row">Start Row</label>
            <input
              type="number"
              id="start_row"
              name="start_row"
              class="form-control"
              required
              value="{{ request.args.get('start_row', '0') }}"
            />
          </div>
        </div>
        <div class="col-md-4">
          <div class="form-group mb-3">
            <label for="additional_rows">Additional Rows to show</label>
            <input
              type="number"
              id="additional_rows"
              name="additional_rows"
              class="form-control"
              required
              value="{{ request.args.get('additional_rows', '100') }}"
            />
          </div>
        </div>
        <div class="col-md-4">
          <div class="form-group mb-3">
            <label for="total_rows">Total rows</label>
            <input
              type="number"
              id="total_rows"
              name="total_rows"
              class="form-control"
              required
              value="{{ request.args.get('total_rows', '100') }}"
            />
          </div>
        </div>
      </div>
      <div class="col-12 mt-4">
        <button type="submit" class="btn w-100 btn-light" id="simulate-button">
          Simulate
        </button>
        <button
          class="btn btn-light w-100 d-none"
          type="button"
          id="loading-button"
          disabled
        >
          <span
            class="spinner-grow spinner-grow-sm mr-2"
            aria-hidden="true"
          ></span>
          <span role="status">Loading...</span>
        </button>
      </div>
    </div>
  </form>

  <table
    class="table text-center table-bordered position-absolute start-0 mt-4"
  >
    <thead>
      <tr>
        <th rowspan="3">#</th>
        <th rowspan="3">Event</th>
        <th rowspan="3">Clock (hours)</th>
        <th colspan="3">Truck Arrival</th>
        <th colspan="2">Truck Load</th>
        <th colspan="3">End of Unloading</th>
        <th rowspan="3">Silo emptying</th>
        <th colspan="2">Silo 1</th>
        <th colspan="2">Silo 2</th>
        <th colspan="2">Silo 3</th>
        <th colspan="2">Silo 4</th>
        <th colspan="3">Suction tube</th>
        <th rowspan="3">Occupation time</th>
        <th rowspan="3">Occupation Percentage</th>
        <th rowspan="3">Total Trucks</th>
        <th rowspan="3">Max Trucks in Queue</th>
        <th colspan="{{ max_trucks }}">Trucks</th>
      </tr>
      <tr>
        <th rowspan="2">Rnd</th>
        <th rowspan="2">Time between arrivals</th>
        <!-- Uniform between 5 and 9 -->
        <th rowspan="2">Next arrival</th>
        <th rowspan="2">Rnd</th>
        <th rowspan="2">Truck Load</th>
        <!-- Could be 10 or 12, equally probable -->
        <th rowspan="2">Unloading time</th>
        <th rowspan="2">Silo Change time</th>
        <th rowspan="2">End of unloading</th>
        <th rowspan="2">State</th>
        <th rowspan="2">Amount of flour</th>
        <th rowspan="2">State</th>
        <th rowspan="2">Amount of flour</th>
        <th rowspan="2">State</th>
        <th rowspan="2">Amount of flour</th>
        <th rowspan="2">State</th>
        <th rowspan="2">Amount of flour</th>
        <th rowspan="2">State</th>
        <th rowspan="2">Queue</th>
        <th rowspan="2">Remaining flour</th>
        {% for i in range(max_trucks) %}
        <th>State</th>
        {% endfor %}
      </tr>
      <tr>
        {% for i in range(max_trucks) %}
        <th>{{ i }}</th>
        {% endfor %}
      </tr>
    </thead>
    <tbody class="table-group-divider">
      {% for row in simulation_data %}
      <tr>
        <td>{{ row.index }}</td>
        <td>{{ row.event }}</td>
        <td>{{ row.clock }}</td>
        <td>{{ row.rnd }}</td>
        <td>{{ row.time_between_arrivals }}</td>
        <td>{{ row.next_arrival }}</td>
        <td>{{ row.rnd_load }}</td>
        <td>{{ row.truck_load }}</td>
        <td>{{ row.unloading_time }}</td>
        <td>{{ row.silo_change_time }}</td>
        <td>{{ row.end_unloading }}</td>
        <td>{{ row.silo_emptying }}</td>
        <td>{{ row.silo_1_state }}</td>
        <td>{{ row.silo_1_flour }}</td>
        <td>{{ row.silo_2_state }}</td>
        <td>{{ row.silo_2_flour }}</td>
        <td>{{ row.silo_3_state }}</td>
        <td>{{ row.silo_3_flour }}</td>
        <td>{{ row.silo_4_state }}</td>
        <td>{{ row.silo_4_flour }}</td>
        <td>{{ row.tube_state }}</td>
        <td>{{ row.tube_queue }}</td>
        <td> {{ row.remaining_truck_load }} </td>
        <td>{{ row.tube_occupation_time }}</td>
        <td>{{ row.tube_occupation_percentage }} %</td>
        <td>{{ row.total_trucks }}</td>
        <td>{{ row.max_queue }}</td>
        {% for i in range(max_trucks) %}
        <td>{{ row.get('truck_' ~ (i) ~ '_state', '-') }}</td>
        {% endfor %}
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
<script>
  document
    .getElementById("simulation-form")
    .addEventListener("submit", function () {
      document.getElementById("simulate-button").classList.add("d-none");
      document.getElementById("loading-button").classList.remove("d-none");
    });
</script>

{% endblock %}
