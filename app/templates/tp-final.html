{% extends 'base.html' %} {% block content %}

<div class="container p-5 w-80">
  <h1 class="text-center">TP Final</h1>
  <form method="GET" action="/tp-final" id="simulation-form">
    <div
      class="rounded border border-dark-subtle bg-secondary-subtle p-4 mt-5 container"
    >
      <div class="row align-items-end mb-3">
        <div class="col-md-4">
          <div class="form-group">
            <label for="start_row">Fila Inicial</label>
            <input
              type="number"
              id="start_row"
              name="start_row"
              class="form-control"
              required
              value="{{ current_params.start_row }}"
            />
          </div>
        </div>
        <div class="col-md-4">
          <div class="form-group">
            <label for="additional_rows">Filas adicionales</label>
            <input
              type="number"
              id="additional_rows"
              name="additional_rows"
              class="form-control"
              required
              value="{{ current_params.additional_rows }}"
            />
          </div>
        </div>
        <div class="col-md-4">
          <div class="form-group">
            <label for="total_rows">Filas en total</label>
            <input
              type="number"
              id="total_rows"
              name="total_rows"
              class="form-control"
              required
              value="{{ current_params.total_rows }}"
            />
          </div>
        </div>
      </div>
      <div class="row align-items-end mb-3">
        <div class="col-md-3">
          <div class="form-group">
            <label for="arrival_time_min">Llegada de camiones - Desde</label>
            <input
              type="number"
              step="0.1"
              id="arrival_time_min"
              name="arrival_time_min"
              class="form-control"
              required
              value="{{ current_params.arrival_time_min }}"
            />
          </div>
        </div>
        <div class="col-md-3">
          <div class="form-group">
            <label for="arrival_time_max">Llegada de camiones - Hasta</label>
            <input
              type="number"
              step="0.1"
              id="arrival_time_max"
              name="arrival_time_max"
              class="form-control"
              required
              value="{{ current_params.arrival_time_max }}"
            />
          </div>
        </div>
        <div class="col-md-3">
          <div class="form-group">
            <label for="silo_change_time">Demora en cambio de silo</label>
            <input
              type="number"
              step="0.01"
              id="silo_change_time"
              name="silo_change_time"
              class="form-control"
              required
              value="{{ current_params.silo_change_time }}"
            />
          </div>
        </div>
        <div class="col-md-3">
          <div class="form-group">
            <label for="plant_consumption_rate">Tasa de consumo de la planta</label>
            <input
              type="number"
              step="0.1"
              id="plant_consumption_rate"
              name="plant_consumption_rate"
              class="form-control"
              required
              value="{{ current_params.plant_consumption_rate }}"
            />
          </div>
        </div>
      </div>
      <div class="col-12 mt-4">
        <button type="submit" class="btn w-100 btn-light" id="simulate-button">
          Simular
        </button>
        <button
          class="btn btn-light w-100 d-none"
          type="button"
          id="loading-button"
          disabled
        >
          <span
            class="spinner-grow spinner-grow-sm mr-2"
            aria-hidden="true"
          ></span>
          <span role="status">Cargando...</span>
        </button>
      </div>
    </div>
  </form>

  {% if simulation_data %}
  <table
    class="table text-center table-bordered position-absolute start-0 mt-4"
  >
    <thead>
      <tr>
        <th rowspan="3">#</th>
        <th rowspan="3">Evento</th>
        <th rowspan="3">Reloj (horas)</th>
        <th colspan="3">Llegada de Camión</th>
        <th colspan="2">Carga de Camión</th>
        <th colspan="3">Fin de Descarga</th>
        <th rowspan="3">Vaciado de Silo</th>
        <th colspan="2">Silo 1</th>
        <th colspan="2">Silo 2</th>
        <th colspan="2">Silo 3</th>
        <th colspan="2">Silo 4</th>
        <th colspan="3">Tubo de succión</th>
        <th rowspan="3">Tiempo de Ocupación</th>
        <th rowspan="3">Porcentaje de Ocupación</th>
        <th rowspan="3">Camiones en total</th>
        <th rowspan="3">Cantidad Máxima de camiones en cola</th>
        <th colspan="{{ max_trucks }}">Camiones</th>
      </tr>
      <tr>
        <th rowspan="2">Rnd</th>
        <th rowspan="2">Tiempo entre llegadas</th>        
        <th rowspan="2">Próxima llegada</th>
        <th rowspan="2">Rnd</th>
        <th rowspan="2">Carga de camión</th>        
        <th rowspan="2">Tiempo de descarga</th>
        <th rowspan="2">Tiempo de cambio de silo</th>
        <th rowspan="2">Fin de descarga</th>
        <th rowspan="2">Estado</th>
        <th rowspan="2">Cantidad de harina</th>
        <th rowspan="2">Estado</th>
        <th rowspan="2">Cantidad de harina</th>
        <th rowspan="2">Estado</th>
        <th rowspan="2">Cantidad de harina</th>
        <th rowspan="2">Estado</th>
        <th rowspan="2">Cantidad de harina</th>
        <th rowspan="2">Estado</th>
        <th rowspan="2">Cola</th>
        <th rowspan="2">Harina Remanente</th>
        {% for i in range(max_trucks) %}
        <th>Estado</th>
        {% endfor %}
      </tr>
      <tr>
        {% for i in range(max_trucks) %}
        <th>{{ i }}</th>
        {% endfor %}
      </tr>
    </thead>
    <tbody class="table-group-divider">
      {% for row in simulation_data %}
      <tr>
        <td>{{ row.index }}</td>
        <td>{{ row.event }}</td>
        <td>{{ row.clock }}</td>
        <td>{{ row.rnd }}</td>
        <td>{{ row.time_between_arrivals }}</td>
        <td>{{ row.next_arrival }}</td>
        <td>{{ row.rnd_load }}</td>
        <td>{{ row.truck_load }}</td>
        <td>{{ row.unloading_time }}</td>
        <td>{{ row.silo_change_time }}</td>
        <td>{{ row.end_unloading }}</td>
        <td>{{ row.silo_emptying }}</td>
        <td>{{ row.silo_1_state }}</td>
        <td>{{ row.silo_1_flour }}</td>
        <td>{{ row.silo_2_state }}</td>
        <td>{{ row.silo_2_flour }}</td>
        <td>{{ row.silo_3_state }}</td>
        <td>{{ row.silo_3_flour }}</td>
        <td>{{ row.silo_4_state }}</td>
        <td>{{ row.silo_4_flour }}</td>
        <td>{{ row.tube_state }}</td>
        <td>{{ row.tube_queue }}</td>
        <td>{{ row.remaining_truck_load }}</td>
        <td>{{ row.tube_occupation_time }}</td>
        <td>{{ row.tube_occupation_percentage }} %</td>
        <td>{{ row.total_trucks }}</td>
        <td>{{ row.max_queue }}</td>
        {% for i in range(max_trucks) %}
        <td>{{ row.get('truck_' ~ (i) ~ '_state', '-') }}</td>
        {% endfor %}
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% endif %}
</div>
<script>
  document
    .getElementById("simulation-form")
    .addEventListener("submit", function () {
      document.getElementById("simulate-button").classList.add("d-none");
      document.getElementById("loading-button").classList.remove("d-none");
    });
</script>

{% endblock %}
